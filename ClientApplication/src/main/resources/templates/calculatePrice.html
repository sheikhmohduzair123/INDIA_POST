<!-- header -->
<th:block th:include="_header"></th:block>
<!-- /header -->

<div class="fixed-header container-sm-footer">
	<div class="site-wrapper market-US">
		<input type="hidden" id="volumetricFactor" th:value="${volumetricFactor}">
		<div id="requiredfieldserror" class="alert alert-danger alert-dismissible" role="alert" style="display: none">
			<strong><span th:text="#{fill.details}">Please fill
					the required details.</span><span>!</span></strong>
			<button type="button" class="close" data-dismiss="alert" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<div id="rateError" class="alert alert-danger alert-dismissible" role="alert" style="display: none">
			<strong><span id="rateErrorMsg" th:text="#{some.error.has.occurred}">Some error has
					occurred</span><span>!</span></strong>
			<button type="button" class="close" data-dismiss="alert" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>

		<form name="priceForm" id="priceForm" autocomplete="off">
			<!--             <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
 -->
			<div class="container col-md-12 spacer-top-sm">
				<div class="col-md-6">
					<div class="form-group">
						<label th:text="#{receiver.pin.code}">Receiver's PIN Code</label>
						<input name="receiverAddress.postalCode" id="recieverPostalCode" autocomplete="off"
							th:minlength="6" th:maxlength="6" class="form-control name" type="text"
							th:placeholder="#{pin.code}">
						<div id="receiverPINErrorContainer" class="errorForm">
							<ul></ul>
						</div>
						<div id="pincodeMsgContainer" class="col-md-12">
							<span id="pincodemsg"></span>
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<div class="form-group">
						<label th:text="#{sender.pin.code}">Sender's PIN Code</label> <input
							name="senderAddress.postalCode" id="senderPostalCode" th:minlength="6" th:maxlength="6"
							autocomplete="off" class="form-control name" type="text" data-toggle="tooltip"
							data-placement="right" th:placeholder="#{pin.code}">
						<div id="senderPINErrorContainer" class="errorForm">
							<ul></ul>
						</div>
						<div id="senderpincodeMsgContainer" class="col-md-12">
							<span id="senderpincodemsg"></span>
						</div>
					</div>
				</div>
			</div>
			<div class="container col-md-12 spacer-top-sm">

				<div class="col-md-6">
					<div class="form-group">
						<label for="parcel_contains" th:text="#{parcel.contents}">Parcel
							Contents</label>
						<div>
							<input id="parcel_contains" name="parcelContent" type="text" class="form-control"
								maxlength="40" th:placeholder="#{parcel.contents}">
							<div id="parcelContentErrorContainer" class="errorForm col-md-12">
								<ul></ul>
							</div>
						</div>
					</div>

				</div>

				<div class="col-md-6">
					<div class="form-group">
						<label th:text="#{parcel.dec.value}">Parcel Declaration
							Value (&#x20B9;)</label> <input name="parcelDeclerationValue" id="pdv" type="text"
							class="form-control" th:maxlength="7" th:placeholder="#{parcel.declaration.value}">
						<div id="parcelDeclarationErrorContainer" class="errorForm">
							<ul></ul>
						</div>
					</div>
				</div>
			</div>

			<!-- Parcel Page -->
			<div id="parcel" class="">
				<div class="scrollSection col-md-8" id="parcel-section">
					<div class="package-selection-section" id="packageSelection">
						<div class="spacer-bottom-lg">
							<div id="choose_package">
								<div class="package-selection">
									<div class="spacer-bottom-md">
										<div class="col-xs-12 col-md-6">
											<p class="instructions" th:text="#{parcel.weight.in.gms.rqd}">Parcel
												Weight (in gms)*</p>
										</div>
										<div class="col-xs-12" id="smbc">
											<div class="white-dropshadow-box">
												<div class="custom-parcel-form">
													<div class="row">
														<div class="col-sm-12 col-md-4 text-center">
															<div class="img-center-vertical">
																<div class="img-responsive center-block">
																	<div>
																		<svg class="img-responsive" version="1.1"
																			id="Layer_1"
																			xmlns="http://www.w3.org/2000/svg"
																			xmlns:xlink="http://www.w3.org/1999/xlink"
																			width="350px" height="280px"
																			viewBox="0 0 350 350">
																			<g id="Layer_16" data-name="Layer 16">
																			</g>
																			<g id="large_b_solid_final"
																				data-name="large b solid final">
																				<polygon fill="#bf8e48"
																					points="211.23 309.32 50.72 239.81 50.72 135.48 211.23 204.98 211.23 309.32">
																				</polygon>
																				<polygon fill="#d5b386"
																					points="50.72 135.55 211.23 205.06 331.71 152.89 171.19 83.39 50.72 135.55">
																				</polygon>
																				<polygon fill="#caa067"
																					points="331.7 152.89 211.24 205.06 211.24 309.39 331.7 257.22 331.7 152.89">
																				</polygon>
																				<polygon fill="#ede1d9" opacity="0.7"
																					points="287.1 172.23 287.1 193.94 261.58 205.3 261.7 183.23 287.1 172.23">
																				</polygon>
																				<polygon fill="#fff0e2"
																					points="128.87 101.74 287.05 172.19 261.65 183.19 102.91 112.96 128.87 101.74">
																				</polygon>
																				<polygon fill="#ede1d9" opacity="0.7"
																					points="287.05 256.91 287.05 276.24 261.54 287.6 261.65 267.91 287.05 256.91">
																				</polygon>
																				<text font-size="18px"
																					font-family="'HelveticaNeue', 'Helvetica Neue'"
																					transform="translate(359.18 206.06)"
																					fill="#717171">H</text>
																				<text font-size="18px"
																					font-family="'HelveticaNeue', 'Helvetica Neue'"
																					transform="translate(290.61 304.35)"
																					fill="#717171">W</text>
																				<text font-size="18px"
																					font-family="'HelveticaNeue', 'Helvetica Neue'"
																					transform="translate(94.82 294.44)"
																					fill="#717171"
																					text-anchor="end">L</text>
																				<line stroke="#9B9B9B"
																					stroke-linecap="round"
																					stroke-miterlimit="10" x1="347.88"
																					y1="249.58" x2="347.88" y2="145.09">
																				</line>
																				<line stroke="#9B9B9B"
																					stroke-linecap="round"
																					stroke-miterlimit="10" x1="195.29"
																					y1="315.42" x2="31.35" y2="244.3">
																				</line>
																				<line stroke="#9B9B9B"
																					stroke-linecap="round"
																					stroke-miterlimit="10" x1="226.11"
																					y1="315.19" x2="347.09" y2="262.8">
																				</line>
																			</g>
																		</svg>
																	</div>
																</div>
															</div>
														</div>

														<div class="col-sm-12 col-md-8">
															<div class="col-xs-6 col-md-8">
																<h4 th:text="#{enter.packaging.details}">Enter
																	Packaging Details</h4>
															</div>
															<!--  <div class="col-sm-6 col-md-4">
                                                                <button type="button" class="btn btn-primary btn-lg btn-icon" id="getWeight" data-toggle="tooltip" data-placement="bottom" title="Get weight from a USB scale">
                                                                    <span th:text="#{get.weight}">Get Weight</span> <i class="pbfont pbfont-scale"></i>
                                                                </button>
                                                            </div> -->

															<div class="col-xs-12 spacer-top-md">
																<div id="PackagingDetailErrorContainer"
																	class="errorForm">
																	<ul></ul>
																</div>

																<div
																	class="form-group form-inline parcel-dimension-inputs">
																	<ul class="list-inline parcel-dimension-label">
																		<li><label
																				th:text="#{dimensions}">Dimensions*</label>
																		</li>
																	</ul>

																	<div class="form-group input-mini">
																		<div class="input-group">
																			<input class="form-control"
																				name="parcelLength"
																				id="parcel-form-length" placeholder="L"
																				type="number"> <span
																				class="input-group-addon">cms</span>
																		</div>
																	</div>

																	<div class="form-group fancy-x">X</div>

																	<div class="form-group input-mini">
																		<div class="input-group">
																			<input class="form-control"
																				name="parcelWidth"
																				id="parcel-form-width" placeholder="W"
																				type="number">
																			<span class="input-group-addon">cms</span>
																		</div>
																	</div>

																	<div class="form-group fancy-x">X</div>

																	<div class="form-group input-mini">
																		<div class="input-group">
																			<input class="form-control"
																				name="parcelHeight"
																				id="parcel-form-height" placeholder="H"
																				type="number"> <span
																				class="input-group-addon">cms</span>
																		</div>
																	</div>

																</div>
															</div>

															<div class="spacer-top-md">
																<div class="col-xs-12 ">

																	<div
																		class="form-group weight-input-directive input-weight">

																		<ul class="list-inline spacer-top-sm-pbdevice">
																			<li>

																				<div>
																					<label th:text="#{dead.wght}">Dead
																						Weight*</label>

																					<div class="input-group">
																						<input
																							id="parcel-form-weight-ounces"
																							name="parcelDeadWeight"
																							class="form-control"
																							type="text"> <span
																							class="input-group-addon">gms</span>
																					</div>
																				</div>

																			</li>
																			<li>
																				<div>
																					<label
																						th:text="#{volumetric.wght}">Volumetric
																						Weight*</label>

																					<div class="input-group">
																						<input id="volumetricWeight"
																							name="parcelVolumeWeight"
																							class="form-control"
																							type="text" readonly="">
																						<span
																							class="input-group-addon">gms</span>
																					</div>

																				</div>
																			</li>

																		</ul>
																	</div>

																</div>
															</div>

														</div>
														<!--                                                         <input style="width: 1px; height:1px;" type="text" readonly/>
 -->
													</div>

												</div>
											</div>

										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-4 spacer-top-xl">

					<div id="services" class="mail-services">

						<div class="col-xs-12 col-md-12 services-table">

							<div class="table-wrapper under-max">
								<div class="table-scroll">
									<div class="spacer-top-md spacer-top-none">
										<select class="form-control name" name="service" id="service">
											<option th:each="postalService : ${postalServiceList}"
												th:value="${postalService.id}" th:id="${postalService.id}"
												th:text="${postalService.serviceName}"></option>
										</select>
									</div>
									<div class="col-md-12 well info-tray border table-details collapse in checkbox-div">
										<div class="col-xs-12 spacer-top-xs">
											<div class="col-xs-12">
												<label class="control checkbox"><input id="glp" name="subServices"
														type="checkbox" value="2"> <span
														class="control-indicator"></span><span>General
														Letter Postage</span></label>
											</div>
										</div>
										<div class="col-xs-12 spacer-top-xs">
											<div class="col-xs-12">
												<label class="control checkbox"><input id="glp" name="subServices"
														type="checkbox" value="3"> <span
														class="control-indicator"></span><span>Document
														Postage</span></label>
											</div>
										</div>
										<div class="col-xs-12 spacer-top-xs">
											<div class="col-xs-12">
												<label class="control checkbox"><input id="glp" name="subServices"
														type="checkbox" value="4"> <span
														class="control-indicator"></span><span>Registeration
														Fee</span></label>
											</div>
										</div>
										<div class="col-xs-12 spacer-top-xs">
											<div class="col-xs-12">
												<label class="control checkbox"><input id="glp" name="subServices"
														type="checkbox" value="5"> <span
														class="control-indicator"></span><span>GEP
														Postage</span></label>
											</div>
										</div>
										<div class="col-xs-12 spacer-top-xs">
											<div class="col-xs-12">
												<label class="control checkbox"><input id="glp" name="subServices"
														type="checkbox" value="6"> <span
														class="control-indicator"></span><span>AD Charge</span></label>
											</div>
										</div>
										<div class="col-xs-12 spacer-top-xs">
											<div class="col-xs-12">
												<label class="control checkbox"><input id="glp" name="subServices"
														type="checkbox" value="7"> <span
														class="control-indicator"></span><span>Registered
														Parcel Postage</span></label>
											</div>
										</div>
									</div>
								</div>
							</div>

						</div>

					</div>
					<div class="col-sm-12 text-center">
						<button type="button" id="SubmitParcelDetails" class="btn btn-primary btn-lg">
							<span th:text="#{get.rate}">Get Rate</span>
						</button>
					</div>
				</div>
			</div>
		</form>

	</div>
</div>

<div class="overlay">
	<div id="loading-img"></div>
</div>
<!-- Modal -->

<div id="bdModalPrint" class="modal fade" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<div class="h3">
					<span class="col-xs-8" th:text="#{net.cal.price}">Net
						Calculated Price</span> <span class="col-xs-4"><span th:text="#{price}">Price</span>
						<span>:</span> <span th:text="#{taka}"></span> <span id="bdModalPrice"> </span></span>
				</div>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true"></span><span class="sr-only">Close</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="row" id="labelOptions">
					<div name="labelPrint">
						<!--Details-->
						<div class="col-sm-12">
							<div class="col-sm-3">
								<h5 th:text="#{sender.pin.code1}">Sender's Pin Code</h5>
								<p id="bdModalSPost"></p>
							</div>
							<div class="col-sm-3">
								<h5 th:text="#{receiver.pin.code1}">Receiver's Pin Code</h5>
								<p id="bdModalRPost"></p>
							</div>

							<div class="col-sm-3">
								<h5 th:text="#{parcel.weight.in.gm1}">Actual Weight (In
									gms)</h5>
								<p id="bdModalWght"></p>
							</div>

							<div class="col-sm-3">
								<h5 th:text="#{parcel.declrd.value}">Parcel Declared Value
									(&#x20B9;)</h5>
								<p id="parcelDV"></p>
							</div>

						</div>

						<div class="col-sm-12">
							<hr />
							<div class="col-sm-12">
								<h5 th:text="#{cost.of.services}">Cost of Services</h5>
								<table class="table taxtable" id="invoiceTable">
									<thead>
										<tr>
											<th th:text="#{service.name}">Service Name</th>
											<th th:text="#{price}">Price</th>
										</tr>
									</thead>
									<tbody>
										<tr id="bdModalGeneralRow">
											<td><span id="bdModalGeneralLabel"></span>
												<!--												<p class="tax" id="bdModalGeneralLabelTaxP"></p></td>-->
											<td>&#x20B9; <span id="bdModalGeneral"></span>
												<!--												<p class="tax" id="bdModalGeneralLabelTaxC"></p>-->
											</td>
										</tr>
										<!--										<tr>-->
										<!--											<td th:text="#{pickup.charges}">Pickup Charges</td>-->
										<!--											<td>&#x20B9; <span id="bdModalPickupCharges"></span></td>-->
										<!--										</tr>-->
										<!--										<tr>-->
										<!--											<td th:text="#{ins.charges}">INS Charges</td>-->
										<!--											<td>&#x20B9; <span id="bdModalInsCharges"></span></td>-->
										<!--										</tr>-->
										<!--										<tr>-->
										<!--											<td th:text="#{cod.charges}">COD Charges</td>-->
										<!--											<td>&#x20B9; <span id="bdModalCodCharges"></span></td>-->
										<!--										</tr>-->
										<tr>
											<td th:text="#{total.tax}">Total Tax</td>
											<td>&#x20B9; <span id="bdModalTotalTax"></span></td>
										</tr>
										<tr>
											<td th:text="#{sub.total}">Sub Total</td>
											<td>&#x20B9; <span id="bdModalSubTotal"></span></td>
										</tr>

									</tbody>
									<tfoot>
										<tr>
											<td th:text="#{total.amount}">Total Amount</td>
											<td>&#x20B9; <span id="bdModalPayableAmnt"></span></td>
										</tr>
									</tfoot>
								</table>
							</div>
						</div>
						<!-- /Details -->
					</div>
				</div>
				<div class="col-sm-12  text-left">
					<ul id="parcelErrors" class="text-danger" style="display: none;">
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<!--//Modal-->

<!-- /Print -->

<script>
	$(function () {
		var token = $("input[name='_csrf']").val();
		var header = "X-CSRF-TOKEN";
		$(document).ajaxSend(function (e, xhr, options) {
			xhr.setRequestHeader(header, token);
		});
	});

	var vol_wgt_flag = 0; //flag to check if volumetric weight has been calculated or not

	var pincodeerrorflag = 0;
	var senderpincodeerrorflag = 0;
	$(document).ready(function () {

		$("#pincodeMsgContainer").hide();

		// Check if body height is higher than window height :)
		if ($(document).height() > $(window).height()) {
			$("#foot").addClass("footer-top-margin");
		}

		$('#recieverPostalCode').on('keyup', function () {
			if ($("#recieverPostalCode").val() == "") {
				$("#pincodeMsgContainer").hide();
			}

			if ($(this).val().length == 6) {
				$("#pincodeMsgContainer").show();

				$.ajax({
					type: "post",
					url: "/parcel/getAddressByPostalcode?ajax=true",
					data: {
						postalCode: $("#recieverPostalCode").val()
					},
					success: function (result) {
						if (result == "") {
							pincodeerrorflag = 1;
							$("#pincodemsg").text("This postal code doesnot exist.");
							$("#pincodemsg").addClass('errorForm');
						}
						else {
							pincodeerrorflag = 0;
							destinationsuboffice = result.subOffice;
							$("#pincodemsg").removeClass('errorForm');
							$("#pincodemsg").text(result.subOffice + ", " + result.thana);
						}
					}
				});
			}
		});

		$('#senderPostalCode').on('keyup', function () {
			if ($("#senderPostalCode").val() == "") {
				$("#senderpincodeMsgContainer").hide();
			}

			if ($(this).val().length == 6) {
				$("#senderpincodeMsgContainer").show();

				$.ajax({

					type: "post",
					url: "/parcel/getAddressByPostalcode?ajax=true",
					data: {
						postalCode: $("#senderPostalCode").val()
					},

					success: function (result) {
						if (result == "") {
							senderpincodeerrorflag = 1;
							$("#senderpincodemsg").text("This postal code doesnot exist.");
							$("#senderpincodemsg").addClass('errorForm');
						}
						else {
							senderpincodeerrorflag = 0;
							destinationsuboffice = result.subOffice;
							$("#senderpincodemsg").removeClass('errorForm');
							$("#senderpincodemsg").text(result.subOffice + ", " + result.thana);
						}
					}
				});

			}
		});

		//Service and Subservices
		var service = $("#service option:first").attr("id");
		$.ajax({
			type: "post",
			url: "/parcel/getSubService?ajax=true",
			data: {
				serviceId: service
			},
			success: function (result) {
				$('.checkbox-div').empty();
				$.each(result, function (index, subService) {
					var row = "<div class='col-xs-12 spacer-top-xs'><div class='col-xs-12'><label class='control checkbox'><input id='glp' name='subServices' type='checkbox' value='" + subService.id + "' > <span class='control-indicator'></span><span>" + subService.serviceName + "</span></label></div></div>";
					$('.checkbox-div').append(row);
				});
				let x = document.querySelectorAll("#glp");
				x.forEach(y => {
					if (y.offsetParent.innerText == "Business Parcel") {
						y.checked = true;
						$(y).attr('onclick', 'return false');

					}
				})
			}
		});
		$('#service').on('change', function () {
			var service = $(this).children(":selected").attr("id");
			$.ajax({
				type: "post",
				url: "/parcel/getSubService?ajax=true",
				data: {
					serviceId: service
				},
				success: function (result) {
					$('.checkbox-div').empty();
					$.each(result, function (index, subService) {
						var row = "<div class='col-xs-12 spacer-top-xs'><div class='col-xs-12'><label class='control checkbox'><input id='glp' name='subServices' type='checkbox' value='" + subService.id + "' > <span class='control-indicator'></span><span>" + subService.serviceName + "</span></label></div></div>";
						$('.checkbox-div').append(row);
					});
				}
			});
		});

		$(".alert-success").hide();
		$(".alert-danger").hide();
		var n = new Date();
		var y = n.getFullYear();
		var m = n.getMonth() + 1;
		var d = n.getDate();
		if (d < 10) {
			d = '0' + d;
		}
		if (m < 10) {
			m = '0' + m;
		}
		$("#shipDate").html(d + '/' + m + '/' + y);

		$("#priceForm")
			.validate({

				rules: {
					"receiverAddress.postalCode": {
						required: true,
						minlength: 6,
						maxlength: 6,
						digits: true
					},
					"senderAddress.postalCode": {
						required: true,
						minlength: 6,
						maxlength: 6,
						digits: true
					},
					"parcelLength": {
						positiveDecimalNumber: true,
						required: true
					},
					"parcelWidth": {
						positiveDecimalNumber: true,
						required: true
					},
					"parcelHeight": {
						positiveDecimalNumber: true,
						required: true
					},
					"parcelVolumeWeight": {
						required: true
					},
					"parcelDeadWeight": {
						positiveDecimalNumber: true,
						required: true
					},
					"parcelDeclerationValue": {
						positiveDecimalNumber: true,
						required: true
					},
					"parcelContent": {
						parcelContentValidation: true
					}
				},

				errorPlacement: function (error, element) {
					if ((element.attr("name") == "receiverAddress.postalCode")) {
						$("#receiverPINErrorContainer").html(error);
						$("#receiverPINErrorContainer").show();
					} else if ((element.attr("name") == "senderAddress.postalCode")) {
						$("#senderPINErrorContainer").html(error);
						$("#senderPINErrorContainer").show();
					} else if ((element.attr("name") == "parcelDeclerationValue")) {
						$("#parcelDeclarationErrorContainer").html(error);
						$("#parcelDeclarationErrorContainer").show();
					} else if ((element
						.attr("name") == "parcelLength") || (element
							.attr("name") == "parcelWidth") || (element
								.attr("name") == "parcelHeight") || (element
									.attr("name") == "parcelVolumeWeight") || (element
										.attr("name") == "parcelDeadWeight")) {
						$(
							"#PackagingDetailErrorContainer")
							.html(error);
						$(
							"#PackagingDetailErrorContainer")
							.show();
					} else if ((element.attr("name") == "parcelContent")) {
						$("#parcelContentErrorContainer")
							.html(error);
						$("#parcelContentErrorContainer")
							.show();
					}

					//displays a tooltip
					element.attr('title', error.text());
					$(element).tooltip({
						position: {
							my: "left+5 center",
							at: "right center"
						},
						trigger: "hover"
					});
				},

				//highlight the error field with red
				highlight: function (element, error) {
					$(element).css('background', '#FFCCCB');
				},

				// Called when the element is valid:
				unhighlight: function (element) {
					$(element).css('background', '#ffffff');
				}
			});

		$("#receiver_sender_continue").click(function () {
			$([document.documentElement,
			document.body
			]).animate({
				scrollTop: $("#parcel").offset().top
			}, 1000);
			$("#parcel").show();
		});

		$('#pmbc').hide();

		$("#pmb").click(function () {
			$("#smbc").hide();
			$("#pmbc").show();
		});

		$("#smb").click(function () {
			$("#pmbc").hide();
			$("#smbc").show();
		});
	});

	$("#SubmitParcelDetails").click(function () {
		if (pincodeerrorflag == 0 && senderpincodeerrorflag == 0) {
			if (($("#priceForm").valid()) && (vol_wgt_flag == 1)) {
				var parcelDetailVO = $("#priceForm").serialize();
				$.ajax({
					type: "post",
					url: "/parcel/calculateRateForParcelAmountPage?ajax=true&",
					data: parcelDetailVO,
					success: function (result) {
						console.log("result" + result);
						if (result.pStatus != null) {

							$("#rateErrorMsg").html(result.pStatus);

							$("#rateError").show();
							window.scrollTo(0, 0);

						}
						else if (result.rateCalculation == null) {
							$("#rateErrorMsg").html("Not able to connect with Rate API");
							$("#rateError").show();
							window.scrollTo(0, 0);

						}

						else {
							$("#bdModalPrint").modal('show');
							$('tr[id^="subService_"]').remove();
							$("#parcelErrors").html("");

							var count = 0;
							if (result.rateCalculation.operationStatus != "SUCCESS") {
								$("#parcelErrors").empty();
								if (result.rateCalculation.rateServiceCategory != null)
									var errorList = "<li>" + result.rateCalculation.errorMsg + ": " + $("#service option[value=" + result.rateCalculation.rateServiceCategory.serviceId + "]").text() + "</li>"
								else
									var errorList = "<li>" + result.rateCalculation.errorMsg + "</li>"
								$("#parcelErrors").append(errorList);
								count = count + 1;
							}

							$.each(result.rateCalculation.subServicesRateCalculation, function (index, subService) {
								if (subService.operationStatus != "SUCCESS") {
									if (subService.rateServiceCategory != null)
										var errorList = "<li>" + subService.errorMsg + ": " + $("input:checkbox[value=" + subService.rateServiceCategory.serviceId + "]").next().next().html() + "</li>"
									else
										var errorList = "<li>" + subService.errorMsg + "</li>"
									$("#parcelErrors").append(errorList);
									count = count + 1;
								}
							});

							$("#bdModalSPost").html(result.senderAddress.postalCode);
							$("#bdModalRPost").html(result.receiverAddress.postalCode);
							//   $("#bdModalGeneral").html(result.invoiceBreakup.price);
							//  $("#bdModalInsurance").html(result.invoiceBreakup.insurance);
							var actualWght = $("#parcel-form-weight-ounces").val();
							if ($("#volumetricWeight").val() > $("#parcel-form-weight-ounces").val())
								actualWght = $("#volumetricWeight").val();
							else
								$("#bdModalWght").html(actualWght);
							$("#parcelDV").html($("#pdv").val());

							if (count == 0) {
								$("#print-btn").show();
								$("#parcelErrors").hide();
							} else {
								$("#print-btn").hide();
								$("#parcelErrors").show();
							}

							if (result.invoiceBreakup != null) {
								$("#bdModalGeneral").html(result.invoiceBreakup.price);
								// <!--                                        if (result.invoiceBreakup.taxPercent != null)-->
								// <!--                                            $("#bdModalGeneralLabelTaxP").html("Tax @ " + result.invoiceBreakup.taxPercent);-->
								// <!--                                        else-->
								// <!--                                            $("#bdModalGeneralLabelTaxP").html("No Tax Applicable");-->
								$("#bdModalTotalTax").html(result.invoiceBreakup.totalTax);
								// <!--										$("#bdModalPickupCharges").html(result.invoiceBreakup.pickupCharges);-->
								// <!--										$("#bdModalInsCharges").html(result.invoiceBreakup.insCharges);-->
								// <!--										$("#bdModalCodCharges").html(result.invoiceBreakup.codCharges);-->
								$("#bdModalSubTotal").html(result.invoiceBreakup.subTotal);
								$("#bdModalPayableAmnt").html(result.invoiceBreakup.payableAmnt);
								$("#bdModalPrice").html(result.invoiceBreakup.payableAmnt);
								$("#bdModalGeneralLabel").html(result.invoiceBreakup.name);
								$("#bdModalGeneralLabelTaxC").html("&#x20B9; " + result.invoiceBreakup.totalTax);
								if (result.invoiceBreakup.subInvoices != null && result.invoiceBreakup.subInvoices.length > 0) {
									$.each(result.invoiceBreakup.subInvoices, function (index, subService) {
										if (result.invoiceBreakup.subInvoices[index] != null) {
											// $("#subService" + index).remove();
											var subTax;
											if (subService.taxPercent != null) {
												subTax = " <p class='tax'>Tax @ " + subService.taxPercent + "</p>";
											} else
												subTax = " <p class='tax'>No Tax Applicable</p>";
											var row = "<tr id='subService_" + index + "'><td>" + subService.name + subTax + "</td>" + "<td>&#x20B9; <span>" + subService.price + "</span>" + "<p class='tax'>&#x20B9; " + subService.totalTax + "</p></td> </tr>";
											$("#bdModalGeneralRow").last().after(row);
										}
									});
								}
							}
						}
					},
					error: function (xhr, textStatus, errorThrown) {
						var err = JSON.parse(xhr.responseText);
						if (err.message == "401")
							$("#rateErrorMsg").html("Unauthorized Access");
						else
							$("#rateErrorMsg").html("Not able to connect with Rate API");
						$("#rateError").show();
						window.scrollTo(0, 0);
					},
					complete: function (data) {
						$(".overlay").hide();
					}
				});
			} else {
				$("#requiredfieldserror").show();
			}
		}


	});

	$("#signout").click(function () {
		location.href = "/logoutSuccessful";
	});


	function calculateVolumetricWeight() {
		var length = parseInt(0);
		var width = parseInt(0);
		var height = parseInt(0);
		var dead_weight = parseInt(0);

		if ($('#parcel-form-length').val() != "") {
			length = $('#parcel-form-length').val();
		}

		if ($('#parcel-form-width').val() != "") {
			width = $('#parcel-form-width').val();
		}
		if ($('#parcel-form-height').val() != "") {
			height = $('#parcel-form-height').val();
		}
		if ($("#parcel-form-weight-ounces").val() != "") {
			dead_weight = $("#parcel-form-weight-ounces").val();
			//$('#volumetricWeight').val(dead_weight);
		}

		$.ajax({
			type: "get",
			url: "/parcel/calculateVolumetricWeght?ajax=true",
			data: {
				length: length,
				width: width,
				height: height,
				dead_weight: dead_weight
			},
			success: function (result) {
				vol_wgt_flag = 1;
				console.log("setting volumetricweight   " + result);
				$('#volumetricWeight').val(result);
				console.log("volumeWeight set in input box");
			},
			error: function () {
				//var result = dead_weight;
				vol_wgt_flag = 0;
				// console.log("setting volumetricweight   " + result);
				// $('#volumetricWeight').val(result);
				
				$("#rateErrorMsg").html("Some error has occured. Could not calculate volumetric weight");
				$("#rateError").show();
				window.scrollTo(0, 0);

			}
		});
	}

	$("#parcel-form-weight-ounces").on('change', function () {
		$("#parcel-form-weight-ounces").val(parseFloat($("#parcel-form-weight-ounces").val()) * 1000);
		calculateVolumetricWeight();

	});



	$('#parcel-form-length').on('change', function () {
		if ($('#parcel-form-length').val().indexOf(',') !== -1) {
			$('#parcel-form-length').val(data[0]);
			$('#parcel-form-width').val(data[1]);
			$('#parcel-form-height').val(data[2]);
			$('#parcel-form-weight-ounces').val(data[3]);
			$('#parcelBarcode').val(data[5]);
		}
	});

	var lastLength = '';
	$('#parcel-form-length').focusout(function () {
		if ($('#parcel-form-length').val() == '')
			$('#parcel-form-length').val(lastLength);
	});

	$('#parcel-form-length').on('click', function () {
		if ($('#parcel-form-length').val() != '')
			lastLength = $('#parcel-form-length').val();

		$('#parcel-form-length').val('');
	});


</script>

<!-- footer -->
<th:block th:include="_footer"></th:block>
<!-- footer -->
</body>