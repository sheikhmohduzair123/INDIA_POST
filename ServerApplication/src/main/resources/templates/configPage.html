<!-- header -->
<th:block th:include="_header"></th:block>
<!-- /header -->
<div class="fixed-header container-sm-footer">
    <div class="site-wrapper market-US">
        <form name="configForm" id="configForm" class="myForm" autocomplete="off" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <strong>
				<h1 class="text-center" th:text="#{config.table}" >Config Table</h1>
			</strong>
                 <div class="col-md-12">
                <div class="col-md-4 col-md-offset-2">
                    <div class="form-group">
                        <label th:text="#{enter.config.type}">Enter Config Type </label>
                       <input name="configTypeId" id="configTypeId" type="hidden">
                        <input name="configType" id="configType" autocomplete="off" class="form-control" type="text" data-toggle="tooltip" th:placeholder="#{config.type}" th:maxlength="50">
                        <div id="ConfigTypeErrorContainer" class="errorForm">
                            <ul></ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label th:text="#{enter.config.value}" > Enter Config Value </label>
                        <input name="configValueId" id="configValueId" type="hidden">
                        <input name="configValue" id="configValue" autocomplete="off" class="form-control" type="text" data-toggle="tooltip" th:placeholder="#{config.value}" th:maxlength="50">
                        <div id="ConfigValueErrorContainer" class="errorForm">
                            <ul></ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2 col-md-offset-4">
                <button type="button" id="submitConfigButton" class="btn btn-primary form-control" th:text="#{add.config}">
                    Add Config
                </button>
                <button type="button" id="updateConfigButton" class="btn btn-primary form-control" th:text="#{update.config}">
                    Update Config
                </button>
            </div>
            <div class="col-md-2">
                <button type="button" id="reset" class="btn btn-primary form-control rBtn" th:text="#{reset}">
                    Reset
                </button>
            </div>
        </form>
        <div class="col-md-12 ">
            <div class="col-md-offset-6 col-md-2"></div>
            <div class="col-md-2">
                <select class="form-control name" name="dropdown" id="dropdownId" align="right">
					<!-- <option>select</option> -->
					<option value="ACTIVE">Active</option>
					<option value="DISABLED">Disable</option>
					<option value="ALL">All</option>
				</select>
            </div>
            <div class="col-md-2">
                <input type="text" id="searchbox" class="form-control name" placeholder="search">
            </div>
        </div>
        <!-- //MODAL -->
        <div id="deleteModal" class="modal fade text-center" data-backdrop="static" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div id="messageBeforeDelete" class="modal-header text-center">
                        <span>
							<h3 class="errorForm" th:text="#{config.sure.message}" style="display: inline">Are you sure you want to delete config type </h3>
							<h3 class="errorForm" style="display: inline"> "</h3>
							<h3 class="errorForm" id="delmsg1" style="display: inline"></h3>
							<h3 class="errorForm" style="display: inline">"?</h3>
							<h5  class="errorForm" th:text="#{confirm.configRollback}">This action cannot be rollback. Config details will be deleted permanently</h5>
						</span>
                    </div>
                    <div id="messageAfterDelete" class="modal-header text-center">
                        <span>
							<h3 style="display: inline">"</h3>
							<h3 id="delmsg2" style="display: inline"></h3>
							<h3 style="display: inline">" </h3>
							<h3 th:text="#{config.type.delete}" style="display: inline">config type deleted successfully</h3>
						</span>
                    </div>
                    <div class="label-options" id="changePassword">
                        <form name='deleteForm' id="deleteForm" autocomplete="off" role="form" method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="hidden" name="deletedId" id="deletedId">
                            <button id="submitDeleteButton" type="button" class="btn btn-primary" th:text="#{delete}">Delete</button>
                            <button id="cancelButton" type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close" th:text="#{cancel}">Cancel
							</button>
                            <button id="okButton" type="button" onclick="javascript:window.location.reload()" class="btn btn-primary btn-md" data-dismiss="modal" aria-hidden="true" th:text="#{okay}">OKay</button>
                        </form>
                    </div> 
                </div>
            </div>
        </div>
        <!-- //End Modal -->
        <div class="col-md-12 ">
            <div class="col-md-offset-7 col-md-5 spacer-bootom-sm"></div>
            <table id="configTable" class="table table-striped">
                <thead>
                    <tr>
                        <th style="display: none">id</th>
                        <th th:text="#{s.no}">S.No.</th>
                        <th th:text="#{config.type}">Config Type</th>
                        <th th:text="#{config.value}">Config Value</th>
                        <th th:text="#{status}">Status</th>
                        <th th:text="#{updated.on}">Updated On</th>
                        <th th:text="#{updated.by}">Updated By</th>
                        <th th:text="#{update}">Update</th>
                        <th th:text="#{delete}">Delete</th>
                    </tr>
                </thead>
                <tbody id="configTBody">
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>


<!-- Error Modal -->
<div id="errorModal" class="modal fade" data-backdrop="static" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <span class="h3 col-xs-12 text-center" th:text="#{sorry.some.error.occurred}">Sorry!! Some error occurred</span>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true"></span><span class="sr-only" th:text="#{close}">Close</span>
				</button>
            </div>
            <div class="text-center">
                <span><button type="button" class="btn btn-primary btn-md"
						  data-dismiss="modal" th:text="#{okay}">Okay</button></span>
            </div>
        </div>
    </div>
</div>
<!-- //Error Modal -->

<!-- config type Already exist Modal -->
<div id="errorUserExistsModal" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h3 style="display: inline">"</h3>
                <h3 id="existVal" style="display: inline"></h3>
                <h3 style="display: inline">" </h3>
                <h3 style="display: inline">config type Already Exists.</h3>
            </div>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true"></span><span class="sr-only" th:text="#{close}">Close</span>
			</button>
            <div class="text-center">
                <button type="button" class="btn btn-primary btn-md" data-dismiss="modal" th:text="#{okay}">Okay</button>
            </div>
        </div>
    </div>
</div>
<!-- //config type Already exist Modal -->

<!-- Added success Modal -->
<div id="saveModal" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h3 style="display: inline">"</h3>
                <h3 id="addVal" style="display: inline"></h3>
                <h3 style="display: inline">" </h3>
                <h3 style="display: inline">Config type added successfully</h3>
            </div>
            <div class="text-center">
                <button id="okButton" type="button" onclick="javascript:window.location.reload()" class="btn btn-primary btn-md" data-dismiss="modal" aria-hidden="true" th:text="#{okay}">okay
				</button>
            </div>
        </div>
    </div>
</div>
<!--  Modal end -->
<!-- updated success Modal -->
<div id="responseModal" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h3 id="responseMsg" style="display: inline;color: green"></h3>
            </div>
            <div class="text-center">
                <button  type="button" onclick="javascript:location.reload()" class="btn btn-primary btn-md" data-dismiss="modal" aria-hidden="true" th:text="#{okay}">Okay
                </button>
            </div>
        </div>
    </div>
</div>
<!--  Modal end -->
<!-- footer -->
<th:block th:include="_footer"></th:block>
<!-- footer -->
</body>
<!-- /Print -->

<script>
    var dtable;
    $(document).ready(function() {
        $('#updateConfigButton').hide();
        $('#configTBody').empty();
        $('#messageAfterDelete').hide();
        $('#okButton').hide();
        showConfigTable();
        // for delete Zone
        $("#submitDeleteButton").click(function() {
            var deletesubOfficeDetails = $("#deleteForm").serialize();
            $.ajax({
                type: "post",
                url: "/masterController/actionDeleteConfig?ajax=true&" + deletesubOfficeDetails,
                success: function(result) {

                    $('#messageAfterDelete').show();
                    $('#messageBeforeDelete').hide();
                    $('#submitDeleteButton').hide();
                    $('#cancelButton').hide();
                    $('#okButton').show();
                },
                error: function() {
                    $('#errorModal').modal('show');
                }
            });
        });
        $('#ok').on('click', function() {
            location.reload();
        });
    });
    $("#configForm").validate({
        rules: {
            "configType": {
                nowhitespaceinstartandend: true,
                digits:false,
                required: true,
                minlength: 2,
                maxlength: 50
            },
            "configValue": {
            	nowhitespaceinstartandend: false,
                digits:false,
                required: true,
                minlength: 1,
                maxlength: 50
            }
        },
        errorPlacement: function(error, element) {
            if ((element.attr("name") == "configType")) {
                $("#ConfigTypeErrorContainer").html(error);
                $("#ConfigTypeErrorContainer").show();
            }
            if ((element.attr("name") == "configValue")) {
                $("#ConfigValueErrorContainer").html(error);
                $("#ConfigValueErrorContainer").show();
            }
            //displays a tooltip
            element.attr('title', error.text());
            $(".error").tooltip({
                position: {
                    my: "left+5 center",
                    at: "right center"
                },
                trigger: "hover"
            });
        },
        //highlight the error field with red
        highlight: function(element, error) {
            $(element).css('background', '#FFCCCB');
        },
        // Called when the element is valid:
        unhighlight: function(element) {
            $(element).css('background', '#ffffff');
        }
    });

    function showConfigTable() {
        var status = $("#dropdownId").val();

        $.ajax({
            type: "post",
            url: "/masterController/showAllActiveStatusConfig?status=" + status,
            dataType: "json",
            cache: false,
            success: function(result) {
                $.each(result, function(i, item) {

                    var updatedby = (item.updatedBy == null) ? "-" : item.updatedBy;

                    var update_date = item.updatedOn;
                    var uTime = new Date(update_date);
                    var updateDate = item.updatedOn.substr(0, 10);
                    var UpdateOndate = updateDate.split("-");
                    var updatedOnDate_string = UpdateOndate[2] + "-" + UpdateOndate[1] + "-" + UpdateOndate[0];

                    var activeStatus = (item.status == 'ACTIVE') ? $('<button class ="fa fa-edit iBtn"></button>') : " - ";
                    var deleteColumn = (item.status == 'ACTIVE') ? $('<button class="fa fa-trash dBtn"></button>') : "-";
                    var $tr = $('<tr>').append(
                        $('<td style="display: none">').text(item.id),
                        $('<td>').text(i + 1),
                        $('<td>').text(item.configType),
                        $('<td>').text(item.configValue),
                        $('<td>').text(item.status),
                        $('<td>' + updatedOnDate_string + " " + uTime.toString().substring(16, 24) + '</td>'),
                        $('<td>').text(updatedby),
                        $('<td>').html(activeStatus),
                        $('<td>').html(deleteColumn)
                    );
                    $('#configTBody').append($tr);
                });
                dtable = $('#configTable').DataTable({
                    "order": ([1, "asc"]),
                    "paging": true,
                    "oLanguage": {
                        "sLengthMenu": "_MENU_"
                    },
                  //to disble page no for 1st page
					"fnDrawCallback": function(oSettings) {
				        if (oSettings._iDisplayLength > oSettings.fnRecordsDisplay()) {
				            $(oSettings.nTableWrapper).find('.dataTables_paginate').hide();
				        }
				        else
				        {
				            $(oSettings.nTableWrapper).find('.dataTables_paginate').show();
				        }
				    },
                /*     aoColumns: [{
                        sWidth: '5%'
                    }, {
                        sWidth: '10%'
                    }, {
                        sWidth: '20%'
                    }, {
                        sWidth: '12%'
                    }, {
                        sWidth: '13%'
                    }, {
                        sWidth: '20%'
                    }, {
                        sWidth: '10%'
                    }, {
                        sWidth: '10%'
                    }, ] */
                });
                $(".dataTables_length").css('clear', 'none');
                $(".dataTables_length").css('margin-top', '-40px');
                $(".dataTables_length").css('margin-left', '0px');
            },
            error: function(response) {
                console.log("something went wrong");
            }
        });
    }

    $("#submitConfigButton").click(function() {
    	//to remove whitespace from front & end
    	$("#configType").val($("#configType").val().trim());

        if ($("#configForm").valid()) {
            var addVal = $("#configType").val();
            var existVal = $("#configType").val();
            var divisionDetail = $("#configForm").serialize();
            
                        $.ajax({
                            type: "post",
                            url: "/masterController/actionConfig?ajax=true&",
                            data: divisionDetail,
                            cache: false, // To unable request pages to be cached & reinitialize the ajax call on every button click
                            success: function(result) {
                            	
                            	$("#responseMsg").text(result);
                            	$("#responseModal").modal('show');
                            },
                            error: function() {
                                $('#errorModal').modal('show');
                            }
                        });       
        }
    });


    $("#updateConfigButton").click(function() {
    	//to remove whitespace from ront & end
    	$("#configType").val($("#configType").val().trim());

        if ($("#configForm").valid()) {
            var addVal = $("#configType").val();
            var existVal = $("#configType").val();
            var divisionDetail = $("#configForm").serialize();            
            
                        $.ajax({
                            type: "post",
                            url: "/masterController/actionUpdateConfig?ajax=true&",
                            data: divisionDetail,
                            cache: false, // To unable request pages to be cached & reinitialize the ajax call on every button click
                            success: function(result) {
                            	$("#responseMsg").text(result);
                            	$("#responseModal").modal('show');
                                
                            },
                            error: function() {
                                //alert("error");
                                $('#errorModal').modal('show');
                            }
                        });
        }
    });

    $("#searchbox").keyup(function() {
        // dtable.fnFilter(this.value); .dataTable
        dtable.search(this.value).draw();
    });

    //Check if body height is higher than window height :)
    if ($(document).height() > $(window).height()) {
        $("#foot").addClass("footer-top-margin");
    }
    $('#dropdownId').on('change', function() {
        var table = $('#configTable').DataTable();
        table.destroy();
        $('#configTBody').empty();
        showConfigTable();
    });

    $('#configTable').on('click', '.iBtn', function() {
        $('#submitConfigButton').hide();
        $('#updateConfigButton').show();
        // get the current row
        var currentRow = $(this).closest("tr");
        var col1 = currentRow.find("td:eq(0)").text(); // get current row 2nd TD
        var col2 = currentRow.find("td:eq(2)").text(); // get current row 1st TD value
        var col3 = currentRow.find("td:eq(3)").text(); // get current row 1st TD value
        $("#configType").val(col2);
        $("#configTypeId").val(col1)
          $("#configValue").val(col3);;
        $('#configType').prop('readonly',true);
        $(window).scrollTop(0);
        // alert(data)
    });

    $('#configTable').on('click', '.dBtn', function() {
        var currentRow = $(this).closest("tr");
        var col2 = currentRow.find("td:eq(2)").text();
        $('#delmsg1').html(col2);
        $('#delmsg2').html(col2);
        $('#deleteModal').modal('show');
        var col1 = currentRow.find("td:eq(0)").text(); //get the id from table row
        $("#deletedId").val(col1);

    });

    $('#reset').on('click', function() {
        $('#submitConfigButton').show();
        $('#updateConfigButton').hide();
        $('.myForm #configType').val('');
        $('.myForm #configValue').val('');
        $('#configType').prop('readonly',false);
    });
</script>